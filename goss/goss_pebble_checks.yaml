# Charm Pebble health checks
command:
  {{ if .Vars.enable_self_tests }}
  pebble-alertmanager:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.alertmanager_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  pebble-catalogue:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.catalogue_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  pebble-grafana:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.grafana_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  pebble-loki:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.loki_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  pebble-prometheus:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.prometheus_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  pebble-traefik:
    exec: juju ssh -m {{ .Vars.model_name }} {{ .Vars.traefik_app_name }}/0 /charm/bin/pebble health
    exit-status: 0
    stdout:
      have-patterns:
      - healthy
    stderr: ""
  {{ end }}
