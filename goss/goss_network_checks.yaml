# Networking checks
command:
  {{ if .Vars.enable_network_tests }}
  loki-reachable-via-ingress-url:
    exec: curl -s $(juju ssh --container loki {{ .Vars.loki_app_name }}/0 cat /etc/loki/loki-local-config.yaml | yq -r '.ruler.external_url')/ready
    exit-status: 0
    stdout:
      have-patterns:
      - ready
    stderr: ""
  loki-can-reach-altermanager-internally:
    exec: bash goss/scripts/test-internal-routing.sh {{ .Vars.model_name }} {{ .Vars.loki_app_name }} {{ .Vars.alertmanager_app_name }}
    exit-status: 0
    stdout:
      have-patterns:
      - 'Status code: 200'
    stderr: ""
  {{ end }}
