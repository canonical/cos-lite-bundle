command:
  validate-model-configuration:
    exec: juju status --format=json -m cos-model
    exit-status: 0
    stdout:
      gjson:
        # Deployed applications
        applications.@keys:
          equal:
            [
              alertmanager,
              catalogue,
              grafana,
              loki,
              mimir-worker-k8s,
              prometheus,
              traefik,
            ]
        # Prometheus relations
        applications.prometheus.relations.@keys:
          equal:
            [
              alertmanager,
              catalogue,
              grafana-dashboard,
              grafana-source,
              ingress,
              metrics-endpoint,
              prometheus-peers,
            ]
        # Alertmanager relations
        applications.alertmanager.relations.@keys:
          equal:
            [
              alerting,
              catalogue,
              grafana-dashboard,
              grafana-source,
              ingress,
              replicas,
              self-metrics-endpoint,
            ]
        # Applications related to Alertmanager over the alerting relation
        applications.alertmanager.relations.alerting.#.related-application:
          equal: [loki, prometheus]
    stderr: ""
