--- # overlay.yaml
applications:
  scrape-target:
    charm: prometheus-scrape-target-k8s
    scale: 1
    trust: true
    channel: edge
    options:
      targets: ${join(",", [for port in PORTS: "${AVALANCHE_URL}:${port}"])}
  scrape-config:
    charm: prometheus-scrape-config-k8s
    scale: 1
    trust: true
    channel: edge
    options:
      scrape-interval: ${SCRAPE_INTERVAL}s
      scrape-timeout: ${max(SCRAPE_INTERVAL - 1, 1)}s

relations:
- - scrape-target:metrics-endpoint
  - scrape-config:configurable-scrape-jobs
- - scrape-config:metrics-endpoint
  - prometheus:metrics-endpoint
